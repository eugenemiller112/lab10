---
title: "Lab 10: Text and Time Analysis"
author: "Johnny Tamanaha, Emily Archambault, Kaiyuan Fan, Eugene Miller, Jingzhi Zhang"
date: "11/3/2019"
output: html_document
---
```{r, setup, message = FALSE, echo = FALSE, warning = FALSE}
library(tidyverse)
temp <- tempfile()
questions <- read_csv("Questions_trunc.csv")
#data1 <- unzip("Answers_trunc.csv.zip")
answers <- read_csv("./Answers_trunc.csv")

```
## Timeliness of the Answer as a Feature
```{r, fig.align='center', echo = FALSE, message = FALSE, warning = FALSE}
#Timeliness of the Answer as a Feature

data <- answers %>%
  group_by(ParentId) %>% #All answers for each question grouped
  mutate(ans_rank = order(order(CreationDate, decreasing = FALSE))) #Ranking answers by CreationDate

#Plotting average score for every rank
ggplot(data, aes(x = ans_rank, y = Score)) +
  stat_summary(fun.y="mean", geom="bar") +
  labs(x = "Answer Rank", title = "Average Score for Every Answer Rank") +
  theme(plot.title = element_text(hjust = 0.5))
```

From this plot, it does not appear as though the timeliness of an answer has any correlation to the score it receives.

Does the data for scores follow a normal distribution? We will create a histogram of scores to determine if the data follows a normal distribution.

```{r, message = FALSE, warning = FALSE, echo = FALSE, fig.align = 'center'}
ggplot(answers)+
  geom_histogram(mapping = aes(x = Score)) +
  scale_x_continuous(name="Score",limits = c(0,100)) + 
  labs(y = "Number of Answers", title = "Distribution of Scores for Answers") +
  theme(plot.title = element_text(hjust = 0.5))
```

From this plot we can see that scores to not follow a normal distribution. This means that Z scores and percentiles will not have the same meaning that they would if the data was normal. The relationship between Z score and percentile is not preserved.


## Individual Sections

### Eugene Miller

The feature of the text that I am measuring is whether a code chunk was included in a question or answer. That is, whether the string `"<code>"` is in a question or an answer. 

```{r echo=FALSE, fig.align=, message=FALSE, warning=FALSE}
code_questions <- questions %>%
  filter(str_detect(`Body`, "<code>"))
noncode_questions <- questions %>%
  filter(!str_detect(`Body`, "<code>"))
code_answers <- answers %>%
  filter(str_detect(`Body`, "<code>"))
noncode_answers <- answers %>%
  filter(!str_detect(`Body`, "<code>"))

question_prop <- count(code_questions)/count(questions)
answer_prop <- count(code_answers)/count(answers)

question_mean <- mean(noncode_questions$Score)
cquestion_mean <- mean(code_questions$Score)
answer_mean <- mean(noncode_answers$Score)
canswer_mean <- mean(code_answers$Score)

plot_data <- tribble(
  ~Title, ~Score,
  "Noncode Questions", question_mean,
  "Code Questions", cquestion_mean,
  "Noncode Answers", answer_mean,
  "Code Answers", canswer_mean
)

ggplot(plot_data) +
  geom_col(aes(x = reorder(Title,Score), y = Score)) + 
  labs(y = "Average Score", x = "Entry Type", title = "Comparison of Code vs Noncode for Questions & Answers") +
  theme(plot.title = element_text(hjust = 0.5))
```

The proportion of questions that invoke the `"<code>"` string is `r question_prop` and the proportion for answers is `r answer_prop`. 

The mean score for a question without code is `r question_mean`, however if the poster includes code in their question it is `r cquestion_mean`. Likewise, for a answer with no code the mean score is `r answer_mean` and if code is included `r canswer_mean`. Therefore both good questions and good answers include code. This makes sense, as Stackoverflow is a forum based on coding questions. Communicating directly via code is more relevant to the theme of the board, and this is why posts involving code have a higher average score. 

### Jingzhi Zhang

The feature of the text that I am measuring is the number of paragraphs that were included in a question or an answer. That is, weather the string `"<p>"` is in a question or an answer.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.align = 'center'}
answers <- mutate(answers, pcount = str_count(Body, "<p>"))
answers
questions <- mutate(questions, pcount = str_count(Body, "<p>"))
questions

ggplot(data = answers, mapping = aes(pcount, Score))+
  geom_jitter()+ylim(c(0,4000))+
  geom_smooth(method = "loess", se = F)+
  labs(title = "Number of Paragraphs Vs. Score", y="Score",x="Number of Paragraphs")
```

This plot shows the relationships between numbers of paragraphs and score. Althought the line shows that as numbers of paragraph growing up the score is going up too, from the plot we can see that most of the dots gather around between 0 to 10 for x-axis and between 0 to 1000 for y-axis which means writing more paragraphs would not guarantee people get higher score and higher score does not exactly depend on number of paragraphs. 
